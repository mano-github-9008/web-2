<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Multiple PDFs Grade Count Graphs</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #f3f4f6;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      background: #fff;
      margin: auto;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .chart-container {
      margin-bottom: 50px;
    }
    canvas {
      width: 100% !important;
      height: 350px !important;
    }
    h3 {
      margin-bottom: 10px;
      font-weight: 600;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>ðŸ“Š Grade Count Bar Charts from Multiple PDFs</h2>
    <div id="charts"></div>
  </div>

<script>
  const gradeMap = { 'O': 10, 'A+': 9, 'A': 8, 'B+': 7, 'B': 6, 'C': 5, 'D': 4, 'F': 0 };
  const pdfFiles = ['FYDS_SEM_1_October_2023.pdf', 'FYDS_SEM_2_October_2023.pdf','SYDS_SEM_4_October_2023']; // Add your PDF filenames here

  // To keep references to Chart instances, so we can manage if needed
  const charts = [];

  async function analyzePDF(pdfFile) {
    try {
      const loadingTask = pdfjsLib.getDocument(pdfFile);
      const pdf = await loadingTask.promise;

      let fullText = '';
      for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
        const page = await pdf.getPage(pageNum);
        const content = await page.getTextContent();
        const pageText = content.items.map(i => i.str).join(' ');
        fullText += pageText + ' ';
      }

      // Extract grades from remark section like "Grade : A+"
      const gradeRegex = /Grade\s*:\s*(O|A\+|A|B\+|B|C|D|F)/g;
      const gradeMatches = [...fullText.matchAll(gradeRegex)];

      // Count grades
      const gradeCount = {};
      Object.keys(gradeMap).forEach(g => gradeCount[g] = 0);

      for (const match of gradeMatches) {
        const grade = match[1];
        if (gradeCount.hasOwnProperty(grade)) {
          gradeCount[grade]++;
        } else {
          gradeCount['F']++;
        }
      }

      return gradeCount;
    } catch (error) {
      console.error(`Error loading or parsing PDF ${pdfFile}:`, error);
      return null;
    }
  }

  function drawChart(containerId, grades, counts, title) {
    const ctx = document.getElementById(containerId).getContext('2d');

    const backgroundColors = grades.map(g => {
      const p = gradeMap[g] ?? 0;
      return p >= 9 ? '#4caf50' : p >= 7 ? '#2196f3' : p >= 5 ? '#ffc107' : '#f44336';
    });

    const chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: grades,
        datasets: [{
          label: 'Number of Students',
          data: counts,
          backgroundColor: backgroundColors,
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true,
            title: { display: true, text: 'Number of Students' }
          },
          x: {
            title: { display: true, text: 'Grade' }
          }
        },
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: ctx => `Count: ${ctx.parsed.y}`
            }
          }
        }
      }
    });

    charts.push(chart);
  }

  async function loadAllPDFs() {
    const chartsDiv = document.getElementById('charts');
    for (let i = 0; i < pdfFiles.length; i++) {
      const pdfFile = pdfFiles[i];
      const gradeCount = await analyzePDF(pdfFile);

      if (!gradeCount) {
        // Show error message if PDF failed
        const errorMsg = document.createElement('p');
        errorMsg.textContent = `Failed to load or parse ${pdfFile}`;
        chartsDiv.appendChild(errorMsg);
        continue;
      }

      // Create container and canvas for this chart
      const container = document.createElement('div');
      container.className = 'chart-container';

      const title = document.createElement('h3');
      title.textContent = `Grades from ${pdfFile}`;
      container.appendChild(title);

      const canvas = document.createElement('canvas');
      canvas.id = `chart-${i}`;
      container.appendChild(canvas);

      chartsDiv.appendChild(container);

      const grades = Object.keys(gradeCount);
      const counts = grades.map(g => gradeCount[g]);

      drawChart(canvas.id, grades, counts, pdfFile);
    }
  }

  // Load and plot all PDFs on page load
  window.onload = loadAllPDFs;
</script>
</body>
</html>
